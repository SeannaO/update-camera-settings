<html>
    <head>
    </head>

    <body>
        <div id = "search-bar">
            <input id="begin_date" type="text"></input>
            <input id="end_date"></input>
            <button id = "search" class = 'btn btn-sm btn-default'><span class='glyphicon glyphicon-search'></span></button>
        </div>

        <div id = "video">
        </div>

        <script>
            $(function() {
                $("#begin_date").datetimepicker({
                    timeFormat: 'HH:mm:ss',       
                });
                $("#end_date").datetimepicker({
                    timeFormat: 'HH:mm:ss',
                });
                $("#search").click(function() {
                    $("#file-list").html("<span class='subtle'>loading...</span>");

                    // converts local time to gmt and then to unix format
                    var begin = moment( $("#begin_date").val() ).unix(); //.add("minutes", moment().zone()).unix();
                    var end = moment( $("#end_date").val() ).unix(); //.add("minutes", moment().zone()).unix();

                    queryVideo(begin, end);
                });

            });


            // 'begin' and 'end' should be on unix format
            var queryVideo = function(begin, end) {

                $.ajax({
                    type: "GET",
                    url: "/?begin="+begin+"&end="+end+"&format=xml",
                    dataType: "xml",
                    success: function(xml) {
                        $(xml).find('filelist').each(function(){
                            var startTime, endTime, fileName, url;

                            $(this).find("StartTime").each(function(){
                                startTime = $(this).text();
                            });

                            $(this).find("EndTime").each(function(){
                                endTime = $(this).text();
                            });

                            $(this).find("FileName").each(function(){
                                var fileName = $(this).text();
                                url = "http://" + nas_url + "/" + fileName;
                                videoList.unshift({
                                    url: url,
                                    start: startTime,
                                    end: endTime
                                });
                            });
                        });


                    }

                    // injects video tag with video from from list
                    var showVideo = function( begin, end ) {

                        var videoHtml = "<video controls autoplay width='640' height='480'>" +
                        "<source src=\"" + video.url + "\" type=\"video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"\">" +
                        "Your browser does not support the <code>video</code> element." +
                        "</video>";
                        $("#video").html(videoHtml);

                    }


                </script>

            </body>
        </html>
